<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.1//EN" "http://www.w3.org/TR/xhtml11/DTD/xhtml11.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="ja">
<head>
<script src="biwascheme.js"> </script>
<script src="codemirror-compressed.js"></script>
<script src="http://ajax.googleapis.com/ajax/libs/jquery/1.8.2/jquery.min.js"></script>
<link rel="stylesheet" type="text/css" href="codemirror.css" />
<link rel="stylesheet" type="text/css" href="isicp.css" />

<script>
function createPrompt(target) {
  if (typeof target == "string") {
    target = $(target);
  }
  code = target.text();
  code = code.replace(/\n*$/, "").replace(/\s*\n/g, "\n");
  target.empty();
  f = $("<textarea>" + code + "</textarea>");
  target.append(f);
  CodeMirror.fromTextArea(f[0],
    {"matchBrackets": true}
  );
}
</script>

<title>iSICP</title>
</head>
<body>

<h1>Interactive SICP</h1>

<div id="sidebar">
<form><textarea id="code"></textarea></form>
<div id="eval"> eval </div>
<div id="bs-console"></div>
</div id="sidebar">

<div id="main">
<h2>Sample</h2>

<div id="scheme-plus">(+ 2 3)</div> <script> createPrompt("#scheme-plus"); </script>

<div id="scheme-boolean">(not #t)</div> <script> createPrompt("#scheme-boolean"); </script>

<div id="scheme-length-y">;;; length by Y combinator 
//createPrompt("(boolean=? #t #t #t)");
//createPrompt("hi");
(((lambda (f) 
  ((lambda (proc) (f (lambda (arg) ((proc proc) arg))))
   (lambda (proc) (f (lambda (arg) ((proc proc) arg))))))
(lambda (self)  
  (lambda (ls) 
    (if (null? ls) 0 (+ 1 (self (cdr ls)))))))   
'(1 2 3 4 5))));
</div> <script> createPrompt("#scheme-length-y"); </script>

<div id="scheme-length-y-tail">;; length by Y combinator (tail recursive)
(((lambda (f)
((lambda (proc) (f (lambda (arg1 arg2) ((proc proc) arg1 arg2))))
   (lambda (proc) (f (lambda (arg1 arg2) ((proc proc) arg1 arg2))))))
(lambda (self) 
  (lambda (ls acc) 
    (if (null? ls) acc (self (cdr ls) (+ 1 acc))))))
'(1 2 3 4 5) 0)
</div> <script> createPrompt("#scheme-length-y-tail"); </script>

</div id="main">

<script type="text/javascript">
var biwascheme = new BiwaScheme.Interpreter( function(e){
  puts(e.message);
  throw(e);
});

var editor = CodeMirror.fromTextArea(document.getElementById("code"), {
  "matchBrackets": true
});

$("#eval").click(function(){
  $("#bs-console").empty();
  var str = editor.getValue();
  biwascheme.evaluate(str, function(result){
    puts(BiwaScheme.to_write(result));
  });
});

$(".scheme").each(function(){
  CodeMirror.fromTextArea($(this).find("textarea")[0],
    {"matchBrackets": true}
  );
});

</script>
</body>
</html>
